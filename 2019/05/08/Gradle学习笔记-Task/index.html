<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Gradle学习笔记-Task"><meta name="keywords" content="Gradle"><meta name="author" content="Leo-Wxy"><meta name="copyright" content="Leo-Wxy"><title>Gradle学习笔记-Task | Wxy的个人博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Task"><span class="toc-number">1.</span> <span class="toc-text">Task</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Result-任务结果"><span class="toc-number">1.1.</span> <span class="toc-text">Task Result(任务结果)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Create-创建任务"><span class="toc-number">1.2.</span> <span class="toc-text">Task Create(创建任务)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Action-执行序列"><span class="toc-number">1.3.</span> <span class="toc-text">Task Action(执行序列)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-DependsOn-执行依赖"><span class="toc-number">1.4.</span> <span class="toc-text">Task DependsOn(执行依赖)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Type-任务类型"><span class="toc-number">1.5.</span> <span class="toc-text">Task Type(任务类型)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Copy"><span class="toc-number">1.5.1.</span> <span class="toc-text">Copy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sync"><span class="toc-number">1.5.2.</span> <span class="toc-text">Sync</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他类型"><span class="toc-number">1.5.3.</span> <span class="toc-text">其他类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义Type"><span class="toc-number">1.5.4.</span> <span class="toc-text">自定义Type</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Group-任务分组-amp-Task-Description-任务描述"><span class="toc-number">1.6.</span> <span class="toc-text">Task Group(任务分组)&amp;Task Description(任务描述)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Overwrite-任务重写"><span class="toc-number">1.7.</span> <span class="toc-text">Task Overwrite(任务重写)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Enable-任务启用"><span class="toc-number">1.8.</span> <span class="toc-text">Task Enable(任务启用)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TaskContainer-任务集合"><span class="toc-number">1.9.</span> <span class="toc-text">TaskContainer(任务集合)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task增量构建"><span class="toc-number">1.10.</span> <span class="toc-text">Task增量构建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-Input-Output-任务输入-输出"><span class="toc-number">1.10.1.</span> <span class="toc-text">Task Input/Output(任务输入/输出)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-Other"><span class="toc-number">1.11.</span> <span class="toc-text">Task Other</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#onlyIf断言"><span class="toc-number">1.11.1.</span> <span class="toc-text">onlyIf断言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#finalizer任务"><span class="toc-number">1.11.2.</span> <span class="toc-text">finalizer任务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#引用"><span class="toc-number">2.</span> <span class="toc-text">引用</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/avatar.png"></div><div class="author-info__name text-center">Leo-Wxy</div><div class="author-info__description text-center">如果我没有见过光明，那我本可以忍受黑暗</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">128</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">19</span></a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Wxy的个人博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">Gradle学习笔记-Task</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-08</time></div><div class="article-container" id="post-content"><blockquote>
<p>Gradle的两个重要的概念：<code>Project</code>和<code>Task</code>，一个<code>Project</code>由多个<code>Task</code>组成。</p>
</blockquote>
<h2 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h2><blockquote>
<p>Gradle脚本中的最小执行单元，也是Gradle中的一个原子操作。</p>
</blockquote>
<h3 id="Task-Result-任务结果"><a href="#Task-Result-任务结果" class="headerlink" title="Task Result(任务结果)"></a>Task Result(任务结果)</h3><p>当Task执行时，最终控制台都会输出执行的结果，后面都会带有一个标签，这些标签表示了<em>是否有Task需要执行，是否执行了Task</em>等状态。</p>
<table>
<thead>
<tr>
<th>结果标签</th>
<th>结果描述</th>
<th>如何触发</th>
</tr>
</thead>
<tbody>
<tr>
<td>没有标签<br>EXECUTED</td>
<td>任务执行完毕</td>
<td>任务有动作且被执行</td>
</tr>
<tr>
<td>UP-TO-DATE</td>
<td>任务输出没有改变</td>
<td>任务没有动作也没有依赖<br>任务有输入输出但是没有发生变化<br>任务没有动作但存在依赖，且依赖非执行完毕</td>
</tr>
<tr>
<td>NO-SOURCE</td>
<td>任务不需要执行</td>
<td>包含了输入输出，但是没有Sources？？？</td>
</tr>
<tr>
<td>FROM-CACHE</td>
<td>在缓存中找到了任务执行结果</td>
<td>构建缓存中已存在构建结果</td>
</tr>
<tr>
<td>SKIPPED</td>
<td>任务没有执行</td>
<td>指定跳过该任务<br>任务设置了<code>onlyIf</code>且返回false<br>任务被禁用<code>enabled=false</code></td>
</tr>
</tbody>
</table>
<h3 id="Task-Create-创建任务"><a href="#Task-Create-创建任务" class="headerlink" title="Task Create(创建任务)"></a>Task Create(创建任务)</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">task createTask1 &lt;&lt; &#123;</span><br><span class="line">  println <span class="string">"doLast in createTask1"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task createTask2 doLast &#123;</span><br><span class="line">  println <span class="string">"doLast in createTask2"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//三种方式皆可</span></span><br><span class="line">project.task(<span class="string">"createTask3"</span>).doLast &#123;</span><br><span class="line">  println <span class="string">"doLast in createTask3"</span></span><br><span class="line">&#125;</span><br><span class="line">project.task(<span class="string">"createTask3"</span>) doLast &#123;</span><br><span class="line">  println <span class="string">"doLast in createTask3"</span></span><br><span class="line">&#125;</span><br><span class="line">project.task(<span class="string">"createTask3"</span>) &lt;&lt; &#123;</span><br><span class="line">  println <span class="string">"doLast in createTask3"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//通过TaskContainer创建Task</span></span><br><span class="line">project.tasks.create(<span class="string">"createTask4"</span>).doLast &#123;</span><br><span class="line">   println <span class="string">"doLast in createTask4"</span></span><br><span class="line">&#125;</span><br><span class="line">project.tasks.create(<span class="string">"createTask4"</span>) doLast &#123;</span><br><span class="line">   println <span class="string">"doLast in createTask4"</span></span><br><span class="line">&#125;</span><br><span class="line">project.tasks.create(<span class="string">"createTask4"</span>) &lt;&lt; &#123;</span><br><span class="line">   println <span class="string">"doLast in createTask4"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其中<code>&lt;&lt;</code>等价于<code>doLast</code>，但是在<code>Gradle 5.0</code>之后该方法已被废弃。</p>
</blockquote>
<p>上述只是基础的创建方法，创建时还包括了其他的参数。</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>含义</th>
<th>参数属性</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>任务名称</td>
<td>必须有值，不能为空</td>
</tr>
<tr>
<td>description</td>
<td>任务描述</td>
<td>可以为空</td>
</tr>
<tr>
<td>group</td>
<td>任务所属分组名</td>
<td>可以为空</td>
</tr>
<tr>
<td>type</td>
<td>任务的父类</td>
<td>默认为<code>org.gradle.api.DefaultTask</code></td>
</tr>
<tr>
<td><strong>dependsOn</strong></td>
<td>任务依赖的其他Task</td>
<td>可以为空</td>
</tr>
<tr>
<td>overwrite</td>
<td>是否覆盖已存在的同名任务</td>
<td>false</td>
</tr>
<tr>
<td>constructorArgs</td>
<td>任务构造函数参数</td>
<td>可以为空(若依赖父类有构造参数，需要设置值)</td>
</tr>
<tr>
<td><strong>action</strong></td>
<td>任务的顺序执行序列</td>
<td><code>doLast(最后执行)</code>、<code>doFirst(最先执行)</code></td>
</tr>
</tbody>
</table>
<h3 id="Task-Action-执行序列"><a href="#Task-Action-执行序列" class="headerlink" title="Task Action(执行序列)"></a>Task Action(执行序列)</h3><blockquote>
<p>一个<code>Task</code>由一系列<code>Action</code>组成的，通过设置<code>action</code>，实质上就是在创建Task时调用到的<code>doFirst</code>、<code>doLast</code>这两个方法。</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">task Task1 &#123;</span><br><span class="line">  println <span class="string">"Task configure"</span></span><br><span class="line">  doFirst &#123;</span><br><span class="line">    println <span class="string">"Task doFirst"</span></span><br><span class="line">  &#125;</span><br><span class="line">  doLast &#123;</span><br><span class="line">    println <span class="string">"Task doLast"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码不同的执行方式结果不同</p>
<ul>
<li><p>执行整个<code>gradle</code>文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Task configure</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行<code>Task1</code>：<code>./gradlew Task1</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Task configure</span><br><span class="line">Task doFirst</span><br><span class="line">Task doLast</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>观察上述结果，得出以下结论</p>
<blockquote>
<p>在创建Task时，除了<code>doFirst</code>、<code>doLast</code>之外的代码，都定义为<code>Task</code>的配置项，在脚本的配置阶段都会执行；而<code>doFirst</code>、<code>doLast</code>代码只会在<code>Task</code>真正执行时才会调用(gradle 指定运行该<code>Task</code>)。</p>
</blockquote>
<h3 id="Task-DependsOn-执行依赖"><a href="#Task-DependsOn-执行依赖" class="headerlink" title="Task DependsOn(执行依赖)"></a>Task DependsOn(执行依赖)</h3><blockquote>
<p>Gradle中的任务执行顺序是不确定的，需要通过task之间的依赖关系，保证被依赖的task优先执行，可通过<code>dependsOn</code>来确定依赖关系。</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">task first doLast &#123;</span><br><span class="line">    println(<span class="string">"first"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task second doLast &#123;</span><br><span class="line">    println(<span class="string">"second"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//second 依赖于 first</span></span><br><span class="line">second.dependsOn(first)</span><br><span class="line"></span><br><span class="line"><span class="comment">//third 依赖于 first,second</span></span><br><span class="line">task third(<span class="string">dependsOn:</span>[first, second]) doLast &#123;</span><br><span class="line">    println(<span class="string">"third"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时调用<code>./gradlew third</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">输出结果</span><br><span class="line">&gt; Task :plugin:first</span><br><span class="line">first</span><br><span class="line"></span><br><span class="line">&gt; Task :plugin:second</span><br><span class="line">second</span><br><span class="line"></span><br><span class="line">&gt; Task :plugin:third</span><br><span class="line">third</span><br></pre></td></tr></table></figure>
<p>由于<code>third</code>依赖于<code>first、second</code>所以在执行<code>third</code>时，<code>first、second</code>也需要执行。</p>
<h3 id="Task-Type-任务类型"><a href="#Task-Type-任务类型" class="headerlink" title="Task Type(任务类型)"></a>Task Type(任务类型)</h3><blockquote>
<p>默认Type为<code>DefaultTask</code>，系统还提供了几种常用的类型以供使用，也可以通过自定义Type来实现功能。</p>
</blockquote>
<h4 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a><a href="https://docs.gradle.org/current/dsl/org.gradle.api.tasks.Copy.html" target="_blank" rel="noopener">Copy</a></h4><blockquote>
<p>将文件复制到目标目录，此任务在复制时也可以执行重命名和过滤文件操作。</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">task CopyFile(<span class="string">type:</span>Copy)&#123;</span><br><span class="line">    <span class="comment">//源文件目录</span></span><br><span class="line">    from <span class="string">'../app/src/main'</span></span><br><span class="line">    <span class="comment">//目标目录</span></span><br><span class="line">    into <span class="string">'./src/main/java'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>from</code>、<code>into</code>是最基础的配置，其他常用包括以下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>释义</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>include</td>
<td>只包含配置的文件</td>
<td><code>include &#39;**/*.java&#39;,   &#39;**/*.kt&#39;</code></td>
</tr>
<tr>
<td>exclude</td>
<td>排除配置的文件</td>
<td><code>exclude &#39;**/*.xml&#39;</code></td>
</tr>
<tr>
<td>includeEmptyDirs</td>
<td>是否包括空文件夹</td>
<td><code>true</code>文件夹下的所有文件夹也会被拷贝进来<br><code>false</code>不会存在空文件夹</td>
</tr>
<tr>
<td>rename</td>
<td>对指定的文件进行重命名</td>
<td><code>rename &#39;activity_*.xml&#39; &#39;rename&#39;</code></td>
</tr>
<tr>
<td>with</td>
<td>执行一个闭包</td>
<td>def dataContent = copySpec {<br>     from (‘../src/main’) { <br>        include ‘*<em>/</em>.xml’    <br> } }<br>with dataContent</td>
</tr>
</tbody>
</table>
<h4 id="Sync"><a href="#Sync" class="headerlink" title="Sync"></a><a href="https://docs.gradle.org/current/dsl/org.gradle.api.tasks.Sync.html" target="_blank" rel="noopener">Sync</a></h4><blockquote>
<p>与Copy任务类似，不同的是<strong>将源目录中的文件复制到目标目录中，但是会删除目标目录中非复制过来的文件。</strong></p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">task syncFile(<span class="string">type:</span>Sync)&#123;</span><br><span class="line">    from <span class="string">'../app/src/main/java'</span></span><br><span class="line">    rename <span class="string">'Main*'</span>, <span class="string">'SSS'</span></span><br><span class="line">    into <span class="string">'./src/main/java'</span></span><br><span class="line"></span><br><span class="line">    includeEmptyDirs = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可通过设置<code>preverse</code>属性，控制哪些文件不会被覆盖</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">task syncFile(<span class="string">type:</span>Sync)&#123;</span><br><span class="line">    from <span class="string">'../app/src/main/java'</span></span><br><span class="line">    rename <span class="string">'Main*'</span>, <span class="string">'SSS'</span></span><br><span class="line">    into <span class="string">'./src/main/java'</span></span><br><span class="line"></span><br><span class="line">    includeEmptyDirs = <span class="literal">false</span></span><br><span class="line">    preserve &#123;</span><br><span class="line">        include <span class="string">'**/*.xml'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么目标目录原有的<code>xml</code>不会被删除</p>
<h4 id="其他类型"><a href="#其他类型" class="headerlink" title="其他类型"></a>其他类型</h4><p>通过<a href="https://docs.gradle.org/current/dsl/" target="_blank" rel="noopener">官网介绍</a>来查询其他系统支持类型</p>
<h4 id="自定义Type"><a href="#自定义Type" class="headerlink" title="自定义Type"></a>自定义Type</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentTask</span> <span class="keyword">extends</span> <span class="title">DefaultTask</span>&#123;</span></span><br><span class="line">    String msg = <span class="string">"parent"</span></span><br><span class="line">    <span class="keyword">int</span> age</span><br><span class="line">    <span class="keyword">int</span> score</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ParentTask(<span class="keyword">int</span> age,<span class="keyword">int</span> score)&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age</span><br><span class="line">        <span class="keyword">this</span>.score = score</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TaskAction</span></span><br><span class="line">    <span class="keyword">void</span> sayHello()&#123;</span><br><span class="line">        println <span class="string">"hello $msg age is $age and score is $score"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置type即父类为 ParentTask 设置参数为 30,100</span></span><br><span class="line">task Task1(<span class="string">type:</span>ParentTask,<span class="string">constructorArgs:</span>[<span class="number">30</span>,<span class="number">100</span>])</span><br><span class="line"></span><br><span class="line">task Task2(<span class="string">type:</span> ParentTask,<span class="string">constructorArgs:</span> [<span class="number">10</span>,<span class="number">70</span>])&#123;</span><br><span class="line">    msg=<span class="string">"wxy"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">&gt; <span class="string">Task :</span><span class="string">plugin:</span>Task1</span><br><span class="line">hello parent age is <span class="number">30</span> and score is <span class="number">100</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="string">Task :</span><span class="string">plugin:</span>Task2</span><br><span class="line">hello wxy age is <span class="number">10</span> and score is <span class="number">70</span></span><br></pre></td></tr></table></figure>
<h3 id="Task-Group-任务分组-amp-Task-Description-任务描述"><a href="#Task-Group-任务分组-amp-Task-Description-任务描述" class="headerlink" title="Task Group(任务分组)&amp;Task Description(任务描述)"></a>Task Group(任务分组)&amp;Task Description(任务描述)</h3><blockquote>
<p>对任务进行分组整理，使结构清晰明了</p>
<p>对任务进行描述，说明任务的作用</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">task MyTask(<span class="string">description:</span><span class="string">"Task的介绍"</span>,<span class="string">group:</span><span class="string">"MyTaskGroup"</span>) doLast &#123;</span><br><span class="line">  println <span class="string">"group $group "</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt; <span class="string">Task :</span><span class="string">plugin:</span>MyTask</span><br><span class="line">group is MyTaskGroup and description is Task的介绍</span><br></pre></td></tr></table></figure>
<p>可以通过执行<code>./gradlew -q tasks --all</code>查看所有task信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyTaskGroup tasks</span><br><span class="line">-----------------</span><br><span class="line">plugin:MyTask - Task的介绍</span><br></pre></td></tr></table></figure>
<h3 id="Task-Overwrite-任务重写"><a href="#Task-Overwrite-任务重写" class="headerlink" title="Task Overwrite(任务重写)"></a>Task Overwrite(任务重写)</h3><blockquote>
<p>对上面的任务进行覆盖，后续只会执行该任务</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">task MyTask(<span class="string">description:</span><span class="string">"Task的介绍"</span>,<span class="string">group:</span><span class="string">"MyTaskGroup"</span>) doLast &#123;</span><br><span class="line">  println <span class="string">"group is $group and description is $description"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task MyTask(<span class="string">overwrite:</span><span class="literal">true</span>) doLast &#123;</span><br><span class="line">  println <span class="string">"Cover Same Task"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后续只会输出<code>Cover Same Task</code></p>
<h3 id="Task-Enable-任务启用"><a href="#Task-Enable-任务启用" class="headerlink" title="Task Enable(任务启用)"></a>Task Enable(任务启用)</h3><blockquote>
<p>通过设置<code>enabled</code>属性，用于启用和禁用任务，默认为<code>true</code>，表示启用。<code>false</code>则禁止该任务执行</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task MyTask &#123;</span><br><span class="line">  enabled <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行会提示 <code>Task :plugin:zipFile SKIPPED</code></p>
<h3 id="TaskContainer-任务集合"><a href="#TaskContainer-任务集合" class="headerlink" title="TaskContainer(任务集合)"></a><a href="https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/TaskContainer.html" target="_blank" rel="noopener">TaskContainer(任务集合)</a></h3><blockquote>
<p>管理所有的Task实例，可通过<code>Project.getTasks()</code>或者<code>tasks</code>使用该实例</p>
</blockquote>
<p>提供了以下常用的方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create(name:String) : Task</code></td>
<td>创建任务</td>
</tr>
<tr>
<td><code>create(name:String,configureClosure:Closure) : Task</code></td>
<td>创建任务</td>
</tr>
<tr>
<td><code>create(options: Map&lt;String, ?&gt;,configure: Closure): Task</code></td>
<td>创建任务</td>
</tr>
<tr>
<td><code>findByPath(path: String): Task</code></td>
<td>查找任务</td>
</tr>
<tr>
<td><code>getByName(name: String): Task</code></td>
<td>根据Task名字查找任务</td>
</tr>
<tr>
<td><code>withType(type: Class): TaskCollection</code></td>
<td>根据Type查找任务</td>
</tr>
<tr>
<td><code>register(String name):TaskProvider</code></td>
<td>按需加载任务</td>
</tr>
<tr>
<td><code>replace(String name):Task</code></td>
<td>替换当前同名任务</td>
</tr>
<tr>
<td><code>remove(Task task)</code></td>
<td>删除任务</td>
</tr>
<tr>
<td><code>whenTaskAdded(action:Closure)</code></td>
<td>task添加进TaskContainer时监听</td>
</tr>
</tbody>
</table>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建Task</span></span><br><span class="line">tasks.create(<span class="string">"Task1"</span>)&#123;&#125;</span><br><span class="line">tasks.create(<span class="string">"Task2"</span>, Copy.<span class="keyword">class</span>)&#123;</span><br><span class="line">    from <span class="string">'../app/src/main/java'</span></span><br><span class="line">    into <span class="string">'./src/main/java'</span></span><br><span class="line">&#125;</span><br><span class="line">tasks.create([<span class="string">name:</span><span class="string">"Task3"</span>,<span class="string">group:</span><span class="string">"customGroup"</span>,<span class="string">desription:</span><span class="string">"desc"</span>,<span class="string">dependsOn:</span>[<span class="string">"Task1"</span>]])&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查找Task</span></span><br><span class="line"><span class="keyword">def</span> task1 = tasks.findByName(<span class="string">"Task1"</span>)</span><br><span class="line"><span class="keyword">def</span> task2 = tasks.withType(Copy.<span class="keyword">class</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//替换Task</span></span><br><span class="line">tasks.replace(<span class="string">"Task1"</span>)&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听Task添加</span></span><br><span class="line">tasks.whenTaskAdded &#123; task-&gt;</span><br><span class="line">    <span class="keyword">if</span>(task.name == <span class="string">"Task1"</span> )&#123;</span><br><span class="line">        println <span class="string">"Task1 is added"</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      println <span class="string">"$&#123;task.name&#125; is added"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Task增量构建"><a href="#Task增量构建" class="headerlink" title="Task增量构建"></a>Task增量构建</h3><blockquote>
<p>Task会缓存每次运行的结果，在下次运行时会检查输出结果是否进行改变，没有发生变化就会跳过当次运行 。为了<strong>提高Gradle的编译速度</strong>。</p>
<p>在控制台会显示<code>up-to-date</code>表示跳过该次执行。</p>
</blockquote>
<h4 id="Task-Input-Output-任务输入-输出"><a href="#Task-Input-Output-任务输入-输出" class="headerlink" title="Task Input/Output(任务输入/输出)"></a>Task Input/Output(任务输入/输出)</h4><blockquote>
<p>任务需要接收</p>
</blockquote>
<h3 id="Task-Other"><a href="#Task-Other" class="headerlink" title="Task Other"></a>Task Other</h3><h4 id="onlyIf断言"><a href="#onlyIf断言" class="headerlink" title="onlyIf断言"></a><code>onlyIf</code>断言</h4><blockquote>
<p><code>onlyIf</code>接收一个闭包作为参数，若闭包中返回<code>true</code>则执行任务，否则跳过该任务(<code>SKIPPED</code>)。<strong>主要用于控制任务的执行场景。</strong></p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">task testOnlyIf&#123;</span><br><span class="line">    println <span class="string">"setOnlyIf"</span></span><br><span class="line">    doLast&#123;</span><br><span class="line">        println <span class="string">"testOnlyIf run "</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">testOnlyIf.onlyIf&#123;</span><br><span class="line">    <span class="keyword">if</span>(project.hasProperty(<span class="string">"skip"</span>))&#123;</span><br><span class="line">         !project.property(<span class="string">"skip"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>命令行中输入<code>./gradlew testOnlyIf -Pskip=true</code>则提示<code>Task :testOnlyIf SKIPPED</code>。设置<code>-Pskip=false</code>则输出<code>testOnlyIf run</code>。</p>
<blockquote>
<p>命令行中<code>-P</code>表示为<code>Project</code>指定<code>K-V</code>格式的属性键值对，使用格式为<code>-PK=V</code></p>
</blockquote>
<h4 id="finalizer任务"><a href="#finalizer任务" class="headerlink" title="finalizer任务"></a><code>finalizer</code>任务</h4><blockquote>
<p>监听任务结束状态，可以在结束后执行其他任务</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">task taskx &#123;</span><br><span class="line">    doLast&#123;</span><br><span class="line">        println <span class="string">"taskx"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task tasky &#123;</span><br><span class="line">    doLast&#123;</span><br><span class="line">        println <span class="string">"tasky"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">taskx.finalizedBy tasky</span><br></pre></td></tr></table></figure>
<p><code>./gradlew taskx -q</code>运行结果为 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; Task :plugin:taskx</span><br><span class="line">taskx</span><br><span class="line"></span><br><span class="line">&gt; Task :plugin:tasky</span><br><span class="line">tasky</span><br><span class="line"></span><br><span class="line">taskx执行完毕就会执行tasky</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Finalizer</code>即使运行过程中出现异常也不会影响到后续任务的执行，只有一种情况下会出现无法执行后续任务。<strong>当前置任务根本没有执行时，不会触发后续任务执行。</strong></p>
</blockquote>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p><a href="https://docs.gradle.org/current/userguide/more_about_tasks.html" target="_blank" rel="noopener">Gradle官方文档</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Leo-Wxy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://leo-wxy.github.io/2019/05/08/Gradle学习笔记-Task/">https://leo-wxy.github.io/2019/05/08/Gradle学习笔记-Task/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://leo-wxy.github.io">Wxy的个人博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Gradle/">Gradle</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/06/14/Gradle学习笔记-Project/"><i class="fa fa-chevron-left">  </i><span>Gradle学习笔记-Project</span></a></div><div class="next-post pull-right"><a href="/2019/04/23/Gradle学习笔记-Groovy/"><span>Gradle学习笔记-Groovy基础</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Leo-Wxy</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>