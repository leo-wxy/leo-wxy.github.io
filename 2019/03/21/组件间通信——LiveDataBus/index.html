<!DOCTYPE html>
<html lang="zh-CN">





<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#9b868d">
  <meta name="description" content="如果我没有见过光明，那我本可以忍受黑暗">
  <meta name="author" content="Leo-Wxy">
  <meta name="keywords" content="">
  <title>组件间通信——LiveDataBus - Wxy的个人博客</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/dracula.min.css">


<!-- 主题依赖的图标库，不要自行修改 -->
<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_fmb4a04yx8h.css">

<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">



<link rel="stylesheet" href="/css/main.css">

<!-- 自定义样式保持在最底部 -->


</head>


<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Wxy's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">
              <i class="iconfont icon-home-fill"></i>
              首页</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">
              <i class="iconfont icon-archive-fill"></i>
              归档</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">
              <i class="iconfont icon-tags-fill"></i>
              标签</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">
              <i class="iconfont icon-user-fill"></i>
              关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
                组件间通信——LiveDataBus
              
            </span>

            
              
                <div class="mt-3 post-meta">
                  <i class="iconfont icon-date-fill" aria-hidden="true"></i>
                  <time datetime="2019-03-21 20:27">
                    2019年3月21日 晚上
                  </time>
                </div>
              

              <div class="mt-1">
                
                  
                  <span class="post-meta mr-2">
                    <i class="iconfont icon-chart"></i>
                    1.5k 字
                  </span>
                

                
                  
                  <span class="post-meta mr-2">
                      <i class="iconfont icon-clock-fill"></i>
                    
                    
                    21
                     分钟
                  </span>
                

                
              </div>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <blockquote>
<p><code>LiveData</code>是一个可以被观察的数据持有类，可以感知并遵循<code>Activity、Fragment，Service</code>等组件的生命周期。由于这种特性可以使他做到在特定生命周期执行特定的操作。</p>
</blockquote>
<p><code>LiveData</code>优点：</p>
<ul>
<li><strong>UI和实时数据保持一致</strong>：可以在数据发生改变时立即响应到</li>
<li><strong>避免内存泄漏</strong>：当绑定的组件被销毁时，会自动清理数据以及移除引用，避免泄漏</li>
</ul>
<p>根据上述优点，就可以利用<code>LiveData</code>去实现一个组件间通信的方案，这套方案相对于<code>EventBus</code>、<code>RxBus</code>有着明显的优势，不需要显式的去调用反注册方法(<em>以免内存泄漏</em>)，而且其自带生命周期感知，可以在Activity等组件处于前台状态时，进行UI更改，避免浪费资源。</p>
<h2 id="LiveDataBus的组成"><a href="#LiveDataBus的组成" class="headerlink" title="LiveDataBus的组成"></a>LiveDataBus的组成</h2><ul>
<li><strong>消息</strong>：用于在组件中通信所传递的数据，可能是基本类型也可能是自定义Model</li>
<li><strong>消息通道</strong>：用消息通道来甄别不同的LiveData(<em>处理对象</em>)</li>
<li><strong>订阅者</strong>：通过消息通道获取对应的<code>LiveData</code>，调用<code>observe()</code>进行订阅</li>
<li><strong>发布者</strong>：通过消息通道获取对应的<code>LiveData</code>，调用<code>postValue()、setValue()</code>进行消息发送</li>
</ul>
<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/LiveDataBus结构.png" srcset="/img/loading.gif" class="full-image" alt="LiveDataBus结构" title="LiveDataBus结构"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span>
<h2 id="LiveDataBus的实现"><a href="#LiveDataBus的实现" class="headerlink" title="LiveDataBus的实现"></a>LiveDataBus的实现</h2><p>按照上述结构图，可以马上就写出一个大致结构</p>
<div class="hljs"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LiveDataBus</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span></span>() &#123;
    <span class="hljs-comment">//用于存放消息通道</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> map: MutableMap&lt;String, MutableLiveData&lt;Any&gt;?&gt;

    init &#123;
        map = HashMap()
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">getChannel</span><span class="hljs-params">(target: <span class="hljs-type">String</span>, type: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: MutableLiveData&lt;T&gt; &#123;
        <span class="hljs-keyword">if</span> (!map.containsKey(target)) &#123;
            map[target] = MutableLiveData()
        &#125;
        <span class="hljs-keyword">return</span> map[target] <span class="hljs-keyword">as</span> MutableLiveData&lt;T&gt;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getChannel</span><span class="hljs-params">(target: <span class="hljs-type">String</span>)</span></span>: MutableLiveData&lt;Any&gt; &#123;
        <span class="hljs-keyword">return</span> getChannel(target, Any::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span>
    &#125;

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> &#123;
        <span class="hljs-keyword">val</span> instance: LiveDataBus <span class="hljs-keyword">by</span> lazy &#123; LiveDataBus() &#125;
    &#125;
&#125;</code></pre></div>
<p>对应发送数据方法</p>
<div class="hljs"><pre><code class="hljs kotlin"><span class="hljs-comment">//同步发送</span>
LiveDataBus.instance.getChannel(<span class="hljs-string">"web"</span>, String::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">value</span> = "<span class="hljs-title">ssa</span>"</span>
<span class="hljs-comment">//异步发送</span>
LiveDataBus.instance.getChannel(<span class="hljs-string">"web"</span>,String::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>).<span class="hljs-title">postValue</span></span>(<span class="hljs-string">"ssa"</span>)</code></pre></div>
<p>对应接收数据方法</p>
<div class="hljs"><pre><code class="hljs kotlin">LiveDataBus.instance.getChannel(<span class="hljs-string">"web"</span>, String::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span>
           .observe(<span class="hljs-keyword">this</span><span class="hljs-symbol">@MainActivity</span>, Observer &#123; s -&gt;
                Log.e(<span class="hljs-string">"web"</span>, s)
           &#125;)</code></pre></div>
<p>但是在实际的使用过程中发现了另一个问题，再打开一个新页面时，如果也存在监听者，就会收到该页面打开前所发送的消息，类似<em>粘性事件</em>，但大部分场景下是不需要这样的，所以需要针对这个问题进行改进。</p>
<h2 id="LiveDataBus改进"><a href="#LiveDataBus改进" class="headerlink" title="LiveDataBus改进"></a>LiveDataBus改进</h2><p>根据<a href="/2019/02/15/LiveData简析/" title="LiveData简析">LiveData简析</a>这部分源码分析可知，LiveData中的数据分发流程如下图所示：</p>
<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/LiveData-dispatch.png" srcset="/img/loading.gif" class="full-image" alt="LiveData Dispatch" title="LiveData Dispatch"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span>
<p>根据上述流程分析：调用到<code>setValue()/postValue()</code>将用户数据进行发送，然后进入到<code>dispatchValue()</code>下进行分发，设置<code>mVersion++(mVersion表示调用方法次数)</code>，想下调用到<code>considerNotify()</code>内部需要判断<code>observer.mLastVersion(Observer注册次数)</code>与<code>mVersion</code>大小，如果小于就会调用到对应<code>Observer.onChanged()</code>事件进行分发。</p>
<p><em>由于初始化时，先会调用到<code>postValue()/setValue()</code>此时mVersion+1，就比<code>mLastVersion</code>要大，就会触发事件的分发。</em></p>
<h3 id="改进方案"><a href="#改进方案" class="headerlink" title="改进方案"></a>改进方案</h3><p><strong>只要可以设置<code>mLastVersion</code>与<code>mVersion</code>保持一致，就不会进行事件的分发。</strong></p>
<p>此时需要利用<strong>反射</strong>的方式对<code>LiveData</code>中的数据进行改变，首先按照需求，先要找到<code>Observer</code>，然后修改其中的<code>mLastVersion</code>即可。</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@MainThread</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">observe</span><span class="hljs-params">(@NonNull LifecycleOwner owner, @NonNull Observer&lt;T&gt; observer)</span> </span>&#123;
       <span class="hljs-keyword">if</span> (owner.getLifecycle().getCurrentState() == DESTROYED) &#123;
           <span class="hljs-comment">// ignore</span>
           <span class="hljs-keyword">return</span>;
       &#125;
       LifecycleBoundObserver wrapper = <span class="hljs-keyword">new</span> LifecycleBoundObserver(owner, observer);
       <span class="hljs-comment">//存储所有的Observer对象</span>
       ObserverWrapper existing = mObservers.putIfAbsent(observer, wrapper);
       <span class="hljs-keyword">if</span> (existing != <span class="hljs-keyword">null</span> &amp;&amp; !existing.isAttachedTo(owner)) &#123;
           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"Cannot add the same observer"</span>
                   + <span class="hljs-string">" with different lifecycles"</span>);
       &#125;
       <span class="hljs-keyword">if</span> (existing != <span class="hljs-keyword">null</span>) &#123;
           <span class="hljs-keyword">return</span>;
       &#125;
       owner.getLifecycle().addObserver(wrapper);
   &#125;</code></pre></div>
<p>需要从<code>mObservers</code>中入手，然后找到对应<code>Observer</code>即可。</p>
<blockquote>
<p>除了<code>observer()</code>外，还有一个<code>observerForever()</code>，该方法是一直存在监听的，而且不会绑定对应的组件，所以可以在任意组件中监听到事件，如果使用时，需要注意销毁。</p>
</blockquote>
<h3 id="改进代码"><a href="#改进代码" class="headerlink" title="改进代码"></a>改进代码</h3><div class="hljs"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.wxy.router.eventbus.utils

<span class="hljs-keyword">import</span> android.arch.lifecycle.LifecycleOwner
<span class="hljs-keyword">import</span> android.arch.lifecycle.LiveData
<span class="hljs-keyword">import</span> android.arch.lifecycle.MutableLiveData
<span class="hljs-keyword">import</span> android.arch.lifecycle.Observer

<span class="hljs-keyword">import</span> android.icu.lang.UCharacter.GraphemeClusterBreak.T
<span class="hljs-keyword">import</span> java.lang.Exception
<span class="hljs-keyword">import</span> java.lang.NullPointerException
<span class="hljs-keyword">import</span> java.util.*


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LiveDataBus</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span></span>() &#123;

    <span class="hljs-comment">//用于存放消息通道</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> map: MutableMap&lt;String, BusMutableLiveData&lt;Any&gt;?&gt;

    init &#123;
        map = HashMap()
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">getChannel</span><span class="hljs-params">(target: <span class="hljs-type">String</span>, type: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: BusMutableLiveData&lt;T&gt; &#123;
        <span class="hljs-keyword">if</span> (!map.containsKey(target)) &#123;
            map[target] = BusMutableLiveData()
        &#125;
        <span class="hljs-keyword">return</span> map[target] <span class="hljs-keyword">as</span> BusMutableLiveData&lt;T&gt;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getChannel</span><span class="hljs-params">(target: <span class="hljs-type">String</span>)</span></span>: BusMutableLiveData&lt;Any&gt; &#123;
        <span class="hljs-keyword">return</span> getChannel(target, Any::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span>
    &#125;

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> &#123;
        <span class="hljs-keyword">val</span> instance: LiveDataBus <span class="hljs-keyword">by</span> lazy &#123; LiveDataBus() &#125;
    &#125;

    <span class="hljs-comment">//Observer装饰类</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ObserverWrapper</span>&lt;<span class="hljs-type">T</span>&gt;</span>() : Observer&lt;T&gt; &#123;

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> observer: Observer&lt;T&gt;? = <span class="hljs-literal">null</span>

        <span class="hljs-keyword">constructor</span>(observer: Observer&lt;T&gt;) : <span class="hljs-keyword">this</span>() &#123;
            <span class="hljs-keyword">this</span>.observer = observer
        &#125;

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onChanged</span><span class="hljs-params">(t: <span class="hljs-type">T</span>?)</span></span> &#123;
            observer?.let &#123;
                <span class="hljs-keyword">if</span> (isCallOnObserve()) <span class="hljs-keyword">return</span><span class="hljs-symbol">@let</span>
                it.onChanged(t)
            &#125;

        &#125;
        <span class="hljs-comment">//判断当前 Observer类型是否为永久存在，如果是则不予处理</span>
        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isCallOnObserve</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> &#123;
            <span class="hljs-keyword">val</span> stackTrace = Thread.currentThread().stackTrace
            <span class="hljs-keyword">if</span> (stackTrace.isNotEmpty()) &#123;
                stackTrace.forEach &#123; stackTraceElement -&gt;
                    <span class="hljs-keyword">if</span> (<span class="hljs-string">"android.arch.lifecycle.LiveData"</span> == stackTraceElement.className &amp;&amp;
                        <span class="hljs-string">"observeForever"</span> == stackTraceElement.methodName
                    ) &#123;
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
                    &#125;
                &#125;
            &#125;
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        &#125;
    &#125;

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BusMutableLiveData</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">MutableLiveData</span>&lt;<span class="hljs-type">T</span>&gt;</span>() &#123;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> observerMap: MutableMap&lt;Observer&lt;T&gt;, Observer&lt;T&gt;&gt; = hashMapOf()

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observe</span><span class="hljs-params">(owner: <span class="hljs-type">LifecycleOwner</span>, observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;
            <span class="hljs-keyword">super</span>.observe(owner, observer)
            <span class="hljs-keyword">try</span> &#123;
                hook(observer)
            &#125; <span class="hljs-keyword">catch</span> (e: Exception) &#123;
                e.printStackTrace()
            &#125;
        &#125;

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observeForever</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;
            <span class="hljs-keyword">if</span> (!observerMap.containsKey(observer)) &#123;
                observerMap[observer] = LiveDataBus.ObserverWrapper(observer)
            &#125;
            <span class="hljs-keyword">super</span>.observeForever(observer)
        &#125;
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">removeObserver</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;
            <span class="hljs-keyword">val</span> realObserver: Observer&lt;T&gt;? = <span class="hljs-keyword">if</span> (observerMap.containsKey(observer)) &#123;
                observerMap.remove(observer)
            &#125; <span class="hljs-keyword">else</span> &#123;
                observer
            &#125;
            realObserver?.let &#123; <span class="hljs-keyword">super</span>.removeObserver(it) &#125;
        &#125;

        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hook</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;
            <span class="hljs-keyword">try</span> &#123;
                <span class="hljs-keyword">val</span> classLiveData = LiveData::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span></span>
                <span class="hljs-comment">//获取LiveData中的 mObservers 对象</span>
                <span class="hljs-keyword">val</span> fieldObservers = classLiveData.getDeclaredField(<span class="hljs-string">"mObservers"</span>)
                fieldObservers.isAccessible = <span class="hljs-literal">true</span>

                <span class="hljs-keyword">val</span> objectObservers = fieldObservers.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">this</span>)
                <span class="hljs-keyword">val</span> classObservers = objectObservers.javaClass
                <span class="hljs-keyword">val</span> methodGet = classObservers.getDeclaredMethod(<span class="hljs-string">"get"</span>, Object::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span>
                methodGet.isAccessible = <span class="hljs-literal">true</span>
                <span class="hljs-keyword">val</span> objectWrapperEntry = methodGet.invoke(objectObservers, observer)
                <span class="hljs-keyword">var</span> objectWrapper: Any? = <span class="hljs-literal">null</span>
                <span class="hljs-keyword">if</span> (objectWrapperEntry <span class="hljs-keyword">is</span> Map.Entry&lt;*, *&gt;) &#123;
                    objectWrapper = objectWrapperEntry.value
                &#125;
                <span class="hljs-keyword">if</span> (objectWrapper == <span class="hljs-literal">null</span>)
                    <span class="hljs-keyword">throw</span> NullPointerException(<span class="hljs-string">"wrapper can not be null"</span>)
                <span class="hljs-comment">//获取对应Observer对象</span>
                <span class="hljs-keyword">val</span> classObserverWrapper = objectWrapper.javaClass.superclass
                <span class="hljs-comment">//获取其中 mLastVersion数据</span>
                <span class="hljs-keyword">val</span> fieldLastVersion = classObserverWrapper.getDeclaredField(<span class="hljs-string">"mLastVersion"</span>)
                fieldLastVersion.isAccessible = <span class="hljs-literal">true</span>
                <span class="hljs-comment">//获取其中mVersion数据</span>
                <span class="hljs-keyword">val</span> fieldVersion = classLiveData.getDeclaredField(<span class="hljs-string">"mVersion"</span>)
                fieldVersion.isAccessible = <span class="hljs-literal">true</span>

                <span class="hljs-keyword">val</span> objectVersion = fieldVersion.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">this</span>)
                <span class="hljs-comment">//重新赋值 使两者相等则事件不会进行分发</span>
                fieldLastVersion.<span class="hljs-keyword">set</span>(objectWrapper, objectVersion)
            &#125; <span class="hljs-keyword">catch</span> (e: Exception) &#123;
                e.printStackTrace()
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Android/">Android</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2019/03/28/Golang学习笔记/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Golang学习笔记-基本概念</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2019/03/15/Java中的锁事/">
                        <span class="hidden-mobile">Java中的锁事</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>






<!-- Plugins -->





  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>


















</body>
</html>
