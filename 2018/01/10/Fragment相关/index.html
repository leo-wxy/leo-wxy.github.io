<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Fragment相关"><meta name="keywords" content="Android"><meta name="author" content="Leo-Wxy"><meta name="copyright" content="Leo-Wxy"><title>Fragment相关 | Wxy的个人博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fragment介绍"><span class="toc-number">1.</span> <span class="toc-text">Fragment介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fragment使用方式"><span class="toc-number">2.</span> <span class="toc-text">Fragment使用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment初始化"><span class="toc-number">2.1.</span> <span class="toc-text">Fragment初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#操作Fragment"><span class="toc-number">2.2.</span> <span class="toc-text">操作Fragment</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fragment生命周期"><span class="toc-number">3.</span> <span class="toc-text">Fragment生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fragment通信"><span class="toc-number">4.</span> <span class="toc-text">Fragment通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment与Activity通信"><span class="toc-number">4.1.</span> <span class="toc-text">Fragment与Activity通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment与Fragment通信"><span class="toc-number">4.2.</span> <span class="toc-text">Fragment与Fragment通信</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fragment常见问题"><span class="toc-number">5.</span> <span class="toc-text">Fragment常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment重叠"><span class="toc-number">5.1.</span> <span class="toc-text">Fragment重叠</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment懒加载"><span class="toc-number">5.2.</span> <span class="toc-text">Fragment懒加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment-startActivityForResult"><span class="toc-number">5.3.</span> <span class="toc-text">Fragment.startActivityForResult()</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Fragment启动，Activity获取结果"><span class="toc-number">5.3.1.</span> <span class="toc-text">Fragment启动，Activity获取结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Fragment启动，Fragment获取结果"><span class="toc-number">5.3.2.</span> <span class="toc-text">Fragment启动，Fragment获取结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment配合ViewPager使用"><span class="toc-number">5.4.</span> <span class="toc-text">Fragment配合ViewPager使用</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/avatar.png"></div><div class="author-info__name text-center">Leo-Wxy</div><div class="author-info__description text-center">如果我没有见过光明，那我本可以忍受黑暗</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">128</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">19</span></a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Wxy的个人博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">Fragment相关</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-01-10</time></div><div class="article-container" id="post-content"><!--Activity和Fragment数据交互 Fragment初始化参数调用哪个方法？ Fragment懒加载怎么实现？Fragment重叠问题-->
<blockquote>
<p>Android中展示界面一般是通过<code>Activity</code>去实现的，当要实现类似商城类的首页时，就会拿出<code>Fragment</code>去实现对应的每个标签页，由<code>Activity</code>进行管理。</p>
</blockquote>
<h2 id="Fragment介绍"><a href="#Fragment介绍" class="headerlink" title="Fragment介绍"></a>Fragment介绍</h2><p><code>Fragment</code>存在必须依附于<code>FragmentActivity</code>使用，并且与<code>FragmentActivity</code>一样，拥有自己独立生命周期，同时可以处理用户的交互动作。并且可以在一个<code>Activity</code>中动态的添加、替换，移除不同的<code>Fragment</code>，同样<code>Fragment</code>也可以拥有多个子<code>Fragment</code>并对他们进行控制，对于信息的显示有很大的便利性。</p>
<h2 id="Fragment使用方式"><a href="#Fragment使用方式" class="headerlink" title="Fragment使用方式"></a>Fragment使用方式</h2><h3 id="Fragment初始化"><a href="#Fragment初始化" class="headerlink" title="Fragment初始化"></a>Fragment初始化</h3><p>默认提供两种初始化方式：</p>
<ul>
<li><p><code>new XXFragment()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DemoFragment fragment = <span class="keyword">new</span> DemoFragment()</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>xml 引入</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"com.demo.fragment.DemoFragment"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>主流使用的是第一种方法，但是并不是推荐的标准用法，如果需要有参数传入的情况下。</p>
<p>在<code>Fragment</code>中添加<code>newInstance()</code>，然后方法里面传入参数，以后获取Fragment就调用该方法，不要使用<code>new</code>方法。</p>
<figure class="highlight java"><figcaption><span>DemoFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DemoFragment <span class="title">newInstance</span><span class="params">(Bundle args)</span> </span>&#123;</span><br><span class="line">    DemoFragment f = <span class="keyword">new</span> DemoFragment();</span><br><span class="line">    f.setArguments(args);</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>DemoActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">args.putString(text,Hello);</span><br><span class="line">MyFragment f = MyFragment.newInstance(args)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Fragment会被重新销毁(可能因为内存不足、手机发生了配置变化)，重新创建时会默认调用无参构造函数。</p>
<p>通过<code>setArguments()</code>传递的Bundle也会被保留下来。</p>
</blockquote>
<h3 id="操作Fragment"><a href="#操作Fragment" class="headerlink" title="操作Fragment"></a>操作Fragment</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取FragmentManager对象 这是Activity方式</span></span><br><span class="line">FragmentManager fragmentManager = getSupportFragmentManager();</span><br><span class="line"></span><br><span class="line"><span class="comment">//从Fragment中获取 FragmentManager</span></span><br><span class="line">FragmentManager fragmentManager = getChildFragmentManager()</span><br><span class="line"><span class="comment">//开启事务，通过 FragmentTransaction 进行add()、remove()等操作</span></span><br><span class="line">FragmentTransaction ft = fragmentManager.beginTransaction();</span><br><span class="line"><span class="comment">//添加Fragment</span></span><br><span class="line">ft.add(R.id.fragment,DemoFragment.newInstance());</span><br><span class="line"><span class="comment">//提交事务</span></span><br><span class="line">ft.commit();</span><br></pre></td></tr></table></figure>
<p>涉及到了以下类：</p>
<p><code>FragmentManager</code></p>
<p>在Activity通过<code>getSupportManager</code>获取该对象，在<code>Fragment</code>中通过<code>getChildFragmentManager()</code>获取</p>
<p><code>FragmentTransaction</code>：Fragment操作事务</p>
<p>通过<code>beginTransaction()</code>开启事务，事务开启后就可以对<code>Fragment</code>进行操作</p>
<p>以下为几种常用的操作方法：</p>
<p><code>add()</code>：添加Fragment到Activity或Fragment中</p>
<p><code>hide()/show()</code>：隐藏和显示Fragment</p>
<p><code>remove()</code>：移除指定Fragment</p>
<p><code>replace()</code>：内部实质是调用<code>remove()</code>和<code>add()</code>完成Fragment修改过程</p>
<p><code>addToBackStack()</code>：添加当前Fragment到回退栈中，当按下返回键时可以根据回退栈进行操作</p>
<p><code>commit()</code>：提交事务，对Fragment进行操作后都需要<code>commit()</code>完成提交后可以生效</p>
<p><code>commitAllowingStateLoss()</code>：也是提交事务的一种，但是不会在其中抛出异常，只是跳过了检测<code>mStateSaved</code>是否进行了保存</p>
<blockquote>
<p>确保<code>commit()</code>在<code>Activity.onPostResume()</code>或者<code>FragmentActivity.onResumeFragments()</code>内调用，而且不要随意使用<code>commitAllowingStateLoss()</code>进行代替，不能滥用该方法。因为忽略状态丢失，Activity意外崩溃时就无法还原之前保存的数据。</p>
</blockquote>
<p>添加Fragment有两种方法：</p>
<p>通过<code>replace()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ft.replace(R.id.fragment,DemoFragment.newInstance())</span><br></pre></td></tr></table></figure>
<p>通过<code>add()</code>配合<code>show()、hide()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ft.add(R.id.fragment,DemoFragment.newInstance());</span><br><span class="line"><span class="comment">//显示时调用</span></span><br><span class="line">ft.show();</span><br><span class="line"><span class="comment">//显示其他Fragment时调用</span></span><br><span class="line">ft.hide()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>replace()</code>不会保留Fragment的状态，会销毁视图并重新加载，调用时保存的数据都会消失。</p>
<p><code>hide()/show()</code>只是对Fragment进行隐藏/显示，不会影响存储的数据</p>
</blockquote>
<h2 id="Fragment生命周期"><a href="#Fragment生命周期" class="headerlink" title="Fragment生命周期"></a>Fragment生命周期</h2><span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/Fragment生命周期.png" class="full-image" alt="Fragment生命周期" title="Fragment生命周期"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span>
<p><code>onAttach()</code>：Fragment和Activity绑定时调用。<strong>Fragment附加到Activity之后，无法再次调用<code>setArguments()</code></strong></p>
<p><code>onCreate()</code>：此时可以获取到<code>setArguments()</code>传递过来的参数，通过Bundle获取</p>
<p><code>onCreateView()</code>：在Fragment加载布局时调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(getLayoutResId(), container, <span class="keyword">false</span><span class="comment">/*不要把View主动添加到container,这个是自动关联的*/</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>onActivityCreated()</code>：当Activity的<code>onCreate()</code>执行完成后调用</p>
<p><code>onDestoryView()</code>：Fragment中布局被移除时调用</p>
<p><code>onDetach()</code>：Fragmen和Activity解绑时调用</p>
<p>其中还有一个<code>setRetainInstance()</code>当调用到该方法时，在Actiivity重新创建时可以完全不销毁<code>Fragment</code>，以便Fragment中恢复数据。调用了</p>
<p><code>setRetainInstance(true)</code>后，Fragment恢复时就会跳过<code>onCreate()</code>、<code>onDestroy()</code>生命周期回调，因此在使用该方法时，<code>onCreate()</code>中不要做初始化逻辑。</p>
<blockquote>
<p>当因为设备配置发生变化时，<code>FragmentManager</code>首先销毁队列中的fragment的视图，接着<code>FragmentManager</code>会检查<code>Fragment</code>中的<code>retainInstance</code>属性，如果为false，直接销毁Fragment实例；若设置为true，fragment的视图会被销毁，但fragment本身不会被销毁，处于短暂的保留状态。当Activity需要时会对其进行恢复。</p>
</blockquote>
<h2 id="Fragment通信"><a href="#Fragment通信" class="headerlink" title="Fragment通信"></a>Fragment通信</h2><h3 id="Fragment与Activity通信"><a href="#Fragment与Activity通信" class="headerlink" title="Fragment与Activity通信"></a>Fragment与Activity通信</h3><ol>
<li><p>如果Activity中包含自己管理的Fragment的引用，可以通过该引用直接访问所有public方法</p>
</li>
<li><p>Activity中未保存任何Fragment的引用，通过给每个Fragment设置<code>Tag或ID</code>，后面通过调用<code>FragmentManager.findFragmentByTag()或FragmentManager.findFragmentById()</code>获取对应Fragment实例</p>
</li>
<li><p>在Fragment通过<code>getActivity()</code>获取Activity实例，然后执行操作。</p>
<p>通过<code>getActivity()</code>获取Activity实例，可能会返回<code>null</code>导致异常。该方法返回结果只会在<code>onAttach()</code>及<code>onDetach()</code>会非空，其他时候都有可能为空，所以可以先使用<code>getContext()</code>去进行替代，这样比较安全。</p>
<p>还有一种就是定义一个全局变量，当触发<code>onAttach()</code>进行赋值，后续调用直接使用该全局变量</p>
<figure class="highlight java"><figcaption><span>DemoFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Context context ;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">  <span class="keyword">super</span>.onAttach(context);</span><br><span class="line">  <span class="keyword">this</span>.context = context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p><strong>使用接口方式(推荐做法)</strong></p>
<figure class="highlight java"><figcaption><span>DemoFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Fragment中定义接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ShowMsgListener</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">showMsg</span><span class="params">(String str)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> ShowMsgListener msgListener; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttach(activity);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(activity!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//获取Activity中实现的接口</span></span><br><span class="line">                msgListener=(DemoActivity)activity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassCastException(activity.toString()</span><br><span class="line">                    + <span class="string">" must implement showMsgListener"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用接口</span></span><br><span class="line">msgListener.showMsg(<span class="string">"From fragment"</span>)；</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>DemoActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> DemoActivity extends FragmentActivity implements ShowMsgListener&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMsg</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">    <span class="comment">//拿来做事</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Fragment从Activity获取数据</p>
</li>
</ol>
<h3 id="Fragment与Fragment通信"><a href="#Fragment与Fragment通信" class="headerlink" title="Fragment与Fragment通信"></a>Fragment与Fragment通信</h3><blockquote>
<p>Fragment之间的通信需要通过Activity进行关联，不应该是直接的进行通信。</p>
</blockquote>
<p>实现通信步骤主要有以下三步：</p>
<ol>
<li>定义接口</li>
<li>Activity实现接口</li>
<li>在接口方法中Activity调用对应Fragment</li>
</ol>
<h2 id="Fragment常见问题"><a href="#Fragment常见问题" class="headerlink" title="Fragment常见问题"></a>Fragment常见问题</h2><h3 id="Fragment重叠"><a href="#Fragment重叠" class="headerlink" title="Fragment重叠"></a>Fragment重叠</h3><p>当<code>宿主Activity</code>因为被系统回收或者配置发生改变导致销毁重建时，会重新执行<code>onCreate()</code>，就有可能重新执行一次<code>Fragment</code>创建过程，然后又会新建一个<code>Fragment</code>。</p>
<figure class="highlight java"><figcaption><span>DemoActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>&#123;</span><br><span class="line">  <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">  setContentView(R.layout.act_demo);</span><br><span class="line">  FragmentManager fm = getSupportFragmentManager();</span><br><span class="line">  FragmentTransaction ft = fm.beginTransaction();</span><br><span class="line">  DemoFragment demoFragment;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//可能触发 内存重启</span></span><br><span class="line">  <span class="keyword">if</span>(savedInstanceState!=<span class="keyword">null</span>)&#123;</span><br><span class="line">    List&lt;Fragment&gt; fragmentList = getSupportFragmentManager().getFragments();</span><br><span class="line">    <span class="keyword">for</span>(Fragment fragment : fragmentList)&#123;</span><br><span class="line">      <span class="keyword">if</span>(fragment <span class="keyword">instanceof</span> DemoFragment)</span><br><span class="line">      	demoFragment = (DemoFragment)fragment</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//直接显示已存在的fragment</span></span><br><span class="line">    ft.show(demoFragment).commit();</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    demoFragment = DemoFragment.newInstance();</span><br><span class="line">    ft.add(R.id.fragment,demoFragment);</span><br><span class="line">    ft.commit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Fragment懒加载"><a href="#Fragment懒加载" class="headerlink" title="Fragment懒加载"></a>Fragment懒加载</h3><blockquote>
<p>懒加载：只在要使用时才去加载数据，而不是在初始化时就加载完毕。</p>
</blockquote>
<p>在加载数据前需要先判断三种状态：</p>
<ul>
<li>数据是否已经加载过</li>
<li>Fragment是否已经调用到<code>onCreate()</code></li>
<li>界面对于用户是否可见</li>
</ul>
<h3 id="Fragment-startActivityForResult"><a href="#Fragment-startActivityForResult" class="headerlink" title="Fragment.startActivityForResult()"></a>Fragment.startActivityForResult()</h3><h4 id="Fragment启动，Activity获取结果"><a href="#Fragment启动，Activity获取结果" class="headerlink" title="Fragment启动，Activity获取结果"></a>Fragment启动，Activity获取结果</h4><figure class="highlight java"><figcaption><span>DemoFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getActivity().startActivityForResult(...)</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>DemoActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode,<span class="keyword">int</span> resultCode,Intent data)</span></span>&#123;</span><br><span class="line">  <span class="keyword">super</span>.onActivityResult(requestCode,resultCode,data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Fragment启动，Fragment获取结果"><a href="#Fragment启动，Fragment获取结果" class="headerlink" title="Fragment启动，Fragment获取结果"></a>Fragment启动，Fragment获取结果</h4><figure class="highlight java"><figcaption><span>DemoFragment.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">startActivityForResult()</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode,<span class="keyword">int</span> resultCode,Intent data)</span></span>&#123;</span><br><span class="line">  <span class="keyword">super</span>.onActivityResult(requestCode,resultCode,data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>DemoActivity.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode,<span class="keyword">int</span> resultCode,Intent data)</span></span>&#123;</span><br><span class="line">  <span class="keyword">super</span>.onActivityResult(requestCode,resultCode,data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>要求父Activity必须覆写了<code>onActivityResult()</code>且调用了<code>super.onActivityResult()</code>。</p>
</blockquote>
<h3 id="Fragment配合ViewPager使用"><a href="#Fragment配合ViewPager使用" class="headerlink" title="Fragment配合ViewPager使用"></a>Fragment配合ViewPager使用</h3><p>一般类似资讯类、新闻类App首页都会分成多个标签，在不同的标签会有不同的内容，这个时候就需要配合ViewPager来实现内容展示，关键在于对应的fragment是否需要进行销毁。</p>
<p>可用的Adapter分为两种：</p>
<ul>
<li><code>FragmentPagerAdapter</code>：对于不再需要的fragment，选择调用<code>detach()</code>，仅销毁视图并不会销毁fragment实例。</li>
<li><code>FragmentStatePagerAdapter</code>：再切换不同fragment的时候，会把前面的fragment进行销毁，但是在系统销毁前，会存储其Fragment的Bundle，倒是需要重新创建Fragment时，可以从<code>onSaveInstanceState()</code>获取保存的数据。</li>
</ul>
<p>使用<code>FragmentStatePagerAdapter</code>比较省内存，但是销毁重建的过程也是需要时间的，如果页面较少可以使用<code>FragmentPageAdapter</code>，很多的话还是推荐<code>FragmentStatePagerAdapter</code>。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Leo-Wxy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/01/10/Fragment相关/">http://yoursite.com/2018/01/10/Fragment相关/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">Wxy的个人博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/01/16/常见算法题整理/"><i class="fa fa-chevron-left">  </i><span>常见算法题整理 - 来自《剑指Offer》</span></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Leo-Wxy</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>